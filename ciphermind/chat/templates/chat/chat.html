<!DOCTYPE html>
<html class="dark" lang="en">

<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport" />
  <title>CipherMind</title>
  <link href="https://fonts.googleapis.com" rel="preconnect" />
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#1173d4',
            'background-light': '#f6f7f8',
            'background-dark': '#101922',
          },
          fontFamily: {
            display: ['Inter', 'sans-serif'],
          },
          borderRadius: {
            DEFAULT: '0.25rem',
            lg: '0.5rem',
            xl: '0.75rem',
            full: '9999px',
          },
        },
      },
    };
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body class="bg-background-light dark:bg-background-dark font-display text-gray-800 dark:text-gray-200">
  <div class="flex h-screen flex-col">
    <header
      class="flex h-16 shrink-0 items-center justify-between border-b border-gray-200/50 dark:border-gray-500/10 bg-background-light/50 dark:bg-background-dark/50 backdrop-blur-sm px-6">
      <div class="flex items-center gap-3">
        <span class="material-symbols-outlined text-primary text-2xl">pest_control</span>
        <h1 class="text-lg font-bold text-gray-900 dark:text-white">CipherMind</h1>
      </div>
      <div class="flex items-center gap-4">
        <button
          class="flex h-9 w-9 items-center justify-center rounded-full text-gray-600 hover:bg-gray-200/50 dark:text-gray-400 dark:hover:bg-gray-700/50">
          <span class="material-symbols-outlined text-xl">settings</span>
        </button>
        <div class="h-10 w-10 rounded-full bg-cover bg-center"
          style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCKqZ4K15jeLtGvbP0xjY0coxVqE_iURxV_1mruajpclVz-xZwU89jng-ntXcWXqzvKn505e_R1BIB_-F-9B6q0do5VT7V8Uw0AeK8I1VzmHEZEN6IUqT2zFP5VVOAeltBv0ZjAechtNnUxNSzYbEDgT_iM33SVfdSXB69GqgM5ZOj13t1NNtbs3kfsdh_V9ypAqttR1Q7q_6_gYhmidYsUjGVyuIwL3-GbhtK8jBjR2KVsj8b_rPdggaz7tkwU-r4VNXTU2wZ-n4s");'>
        </div>
      </div>
    </header>

    <main class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8" id="chatContainer">
      <div class="mx-auto max-w-4xl space-y-8">
        <div class="space-y-6" id="messagesContainer">
          <!-- Message initial de l'IA -->
          <div class="flex items-start gap-4">
            <div class="h-10 w-10 shrink-0 rounded-full bg-cover bg-center"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCYVfB-jexZmXqIqph8EiZykNvdX5wPImqAOegnNGxjeJjPVyubYrWutVhXhMMSaKXjvIttD-GC76eNI_Fe_zHFE-jpOoaFo_GfTZ3aKotX_M9awK94keSN2_gFrJMmLJerAcUt74wcPcUswhvimiSPPx_3OGX56FZDV_KC_75ZtJZjag8Sbr01c_5Ci8lyduFBUryrp26Wg5-YvN4DHaomNNw9nogP31uwQ5K7rS7yyQHpvZPItgD_Gv3rtZhrQSRE4tXe0j-ADYk");'>
            </div>
            <div class="flex flex-col items-start">
              <p class="text-sm font-medium text-gray-500 dark:text-gray-400">AI Detective</p>
              <div
                class="mt-1 max-w-md rounded-lg rounded-tl-none bg-gray-200/80 p-3 text-gray-800 dark:bg-gray-800/80 dark:text-gray-200">
                <p>Bonjour, détective ! Je suis prêt à vous assister dans votre enquête. Comment puis-je vous aider aujourd'hui ?</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <div
      class="shrink-0 border-t border-gray-200/50 dark:border-gray-500/10 bg-background-light dark:bg-background-dark p-4 sm:p-6">
      <div class="mx-auto max-w-4xl space-y-4">
        <div class="flex items-center gap-2">
          <input id="messageInput"
            class="form-input w-full flex-1 resize-none rounded-lg border-gray-300 bg-gray-200/50 text-gray-900 placeholder:text-gray-500 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800/50 dark:text-white dark:placeholder:text-gray-400 dark:focus:border-primary"
            placeholder="Tapez votre message..." type="text" />
          <button id="sendButton"
            class="flex h-10 items-center justify-center rounded-lg bg-primary px-4 text-sm font-medium text-white transition-colors hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark">
            <span>Envoyer</span>
            <span class="material-symbols-outlined ml-2 text-base">send</span>
          </button>
        </div>
      </div>
    </div>

    <aside
      class="shrink-0 border-t border-gray-200/50 dark:border-gray-500/10 bg-background-light dark:bg-background-dark p-4 sm:p-6">
      <div class="mx-auto max-w-4xl">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">Investigation Notes</h3>
        <textarea id="notesTextarea"
          class="form-textarea w-full h-24 resize-none rounded-lg border-gray-300 bg-gray-200/50 text-gray-900 placeholder:text-gray-500 focus:border-primary focus:ring-primary dark:border-gray-700 dark:bg-gray-800/50 dark:text-white dark:placeholder:text-gray-400 dark:focus:border-primary"
          placeholder="Write down your clues, thoughts, and connections here..."></textarea>
        <div class="mt-3 flex justify-end gap-2">
          <button id="clearNotesButton"
            class="flex h-10 items-center justify-center rounded-lg border border-gray-300 dark:border-gray-700 px-4 text-sm font-medium text-gray-700 dark:text-gray-300 transition-colors hover:bg-gray-100 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark">
            <span>Clear</span>
          </button>
          <button id="saveNotesButton"
            class="flex h-10 items-center justify-center rounded-lg bg-primary px-4 text-sm font-medium text-white transition-colors hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 dark:focus:ring-offset-background-dark">
            <span>Save Notes</span>
          </button>
        </div>
      </div>
    </aside>
  </div>

  <script>
    const messageInput = document.getElementById('messageInput');
    const sendButton = document.getElementById('sendButton');
    const messagesContainer = document.getElementById('messagesContainer');
    const chatContainer = document.getElementById('chatContainer');
    const notesTextarea = document.getElementById('notesTextarea');
    const clearNotesButton = document.getElementById('clearNotesButton');
    const saveNotesButton = document.getElementById('saveNotesButton');

    const userAvatarUrl = "https://lh3.googleusercontent.com/aida-public/AB6AXuCKqZ4K15jeLtGvbP0xjY0coxVqE_iURxV_1mruajpclVz-xZwU89jng-ntXcWXqzvKn505e_R1BIB_-F-9B6q0do5VT7V8Uw0AeK8I1VzmHEZEN6IUqT2zFP5VVOAeltBv0ZjAechtNnUxNSzYbEDgT_iM33SVfdSXB69GqgM5ZOj13t1NNtbs3kfsdh_V9ypAqttR1Q7q_6_gYhmidYsUjGVyuIwL3-GbhtK8jBjR2KVsj8b_rPdggaz7tkwU-r4VNXTU2wZ-n4s";
    const aiAvatarUrl = "https://lh3.googleusercontent.com/aida-public/AB6AXuCYVfB-jexZmXqIqph8EiZykNvdX5wPImqAOegnNGxjeJjPVyubYrWutVhXhMMSaKXjvIttD-GC76eNI_Fe_zHFE-jpOoaFo_GfTZ3aKotX_M9awK94keSN2_gFrJMmLJerAcUt74wcPcUswhvimiSPPx_3OGX56FZDV_KC_75ZtJZjag8Sbr01c_5Ci8lyduFBUryrp26Wg5-YvN4DHaomNNw9nogP31uwQ5K7rS7yyQHpvZPItgD_Gv3rtZhrQSRE4tXe0j-ADYk";

    function addUserMessage(message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'flex items-start gap-4 justify-end';
      messageDiv.innerHTML = `
        <div class="flex flex-col items-end">
          <p class="text-sm font-medium text-gray-500 dark:text-gray-400">You</p>
          <div class="mt-1 max-w-md rounded-lg rounded-tr-none bg-primary p-3 text-white">
            <p>${escapeHtml(message)}</p>
          </div>
        </div>
        <div class="h-10 w-10 rounded-full bg-cover bg-center" style='background-image: url("${userAvatarUrl}");'></div>
      `;
      messagesContainer.appendChild(messageDiv);
      scrollToBottom();
    }

    function addAIMessage(message) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'flex items-start gap-4';
      messageDiv.innerHTML = `
        <div class="h-10 w-10 shrink-0 rounded-full bg-cover bg-center" style='background-image: url("${aiAvatarUrl}");'></div>
        <div class="flex flex-col items-start">
          <p class="text-sm font-medium text-gray-500 dark:text-gray-400">AI Detective</p>
          <div class="mt-1 max-w-md rounded-lg rounded-tl-none bg-gray-200/80 p-3 text-gray-800 dark:bg-gray-800/80 dark:text-gray-200">
            <p>${escapeHtml(message)}</p>
          </div>
        </div>
      `;
      messagesContainer.appendChild(messageDiv);
      scrollToBottom();
    }

    function addLoadingMessage() {
      // Fonction non utilisée - supprimée
    }

    function removeLoadingMessage() {
      // Fonction non utilisée - supprimée
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function scrollToBottom() {
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    async function sendMessage() {
      const message = messageInput.value.trim();
      if (!message) return;

      addUserMessage(message);
      messageInput.value = '';
      sendButton.disabled = true;

      try {
        const response = await fetch('/chat/send-message/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ message: message })
        });

        const data = await response.json();

        if (data.success) {
          addAIMessage(data.message);
        } else {
          addAIMessage('Désolé, une erreur est survenue : ' + (data.error || 'Erreur inconnue'));
        }
      } catch (error) {
        addAIMessage('Erreur de connexion au serveur. Veuillez réessayer.');
        console.error('Error:', error);
      } finally {
        sendButton.disabled = false;
        messageInput.focus();
      }
    }

    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    clearNotesButton.addEventListener('click', () => {
      notesTextarea.value = '';
    });

    saveNotesButton.addEventListener('click', () => {
      const notes = notesTextarea.value;
      if (notes.trim()) {
        alert('Notes sauvegardées ! (Fonctionnalité à implémenter côté serveur)');
      }
    });

    messageInput.focus();
  </script>

</body>

</html>